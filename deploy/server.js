import n from"express";import"vite-express";import g from"body-parser";import i from"path";import{fileURLToPath as h}from"node:url";import y from"dotenv";import b from"morgan";import j from"nunjucks";import k from"express-nunjucks";import v from"compression";import I from"serve-favicon";import R from"node-fetch";const f=async o=>{const e=`https://www.rijksmuseum.nl/api/en/collection?key=${process.env.VITE_API_KEY}&imgonly=true`;let t=e;try{let r=`&q=${o}`;t=e+r,console.log(t);const a=await m(t);return await w(a)}catch(r){console.log(r)}finally{console.log("SearchDone")}},p=async o=>{try{const e=`https://www.rijksmuseum.nl/api/en/collection?key=${process.env.VITE_API_KEY}`,t=`&involvedMaker=${o}`,r="&imgonly=true&ps=5&toppieces=true",a=e+t,u=await m(a);return await w(u)}catch(e){console.log(e)}finally{console.log("got By maker")}},E=async o=>{const e=`https://www.rijksmuseum.nl/api/en/collection/${o}/?key=${process.env.VITE_API_KEY}`;try{const t=await m(e);return await q(t)}catch(t){console.log(t)}finally{console.log("Got id ")}},m=async o=>{try{return await(await R(o)).json()}catch(e){throw console.log(e),new Error(e)}},w=o=>o.artObjects.map(t=>{const r=t.webImage&&t.webImage.url.endsWith("=s0")?t.webImage.url.replace("=s0","=s800"):void 0;return{id:t.objectNumber,title:t.title,name:t.name,headerImage:t.headerImage,productionPlaces:t.productionPlaces,links:t.links,longTitle:t.longTitle,webImage:t.webImage,smallImage:r,principalOrFirstMaker:t.principalOrFirstMaker}}),q=o=>{const e=o.artObject,t=e.webImage&&e.webImage.url.endsWith("=s0")?e.webImage.url.replace("=s0","=s800"):void 0;return{id:e.objectNumber,title:e.title,titles:e.titles,materials:e.materials,description:e.description,productionPlaces:e.productionPlaces,longTitle:e.longTitle,webImage:e.webImage,smallImage:t,principalOrFirstMaker:e.principalOrFirstMaker,physicalMedium:e.physicalMedium,subTitle:e.subTitle,plaqueDescription:e.plaqueDescription,principalMaker:e.principalMaker,location:e.location}},O=async(o,e,t)=>{try{const r=await p("Rembrandt+van+Rijn"),a=await p("Johannes+Vermeer");return e.render("index.njk",{title:"home",makers:[{name:"Rembrand",data:r},{name:"Johannes Vermeer",data:a}]})}catch(r){console.log(r),t(r)}},_=async(o,e,t)=>{try{const r=await f("Rembrand");return e.render("collection.njk",{title:"Collecton",query:"Rembrand",data:r})}catch(r){console.log(r),t(r)}},M=async(o,e,t)=>{const r=o.params.id;console.log(o.params);try{const a=await E(r);return e.render("details.njk",{title:"Collecton",data:a})}catch(a){console.log(a),t(a)}},T=async(o,e,t)=>{const r=await o.query.q;try{console.log(o.query);const a=await f(r);return e.render("search.njk",{title:"Search",query:r,data:a})}catch{t(err)}},l=n.Router();l.get("/",O);l.get("/search/:q",T);l.get("/collection",_);l.get("/collection/:id",M);l.get("/offline",(o,e,t)=>{try{e.render("offline.njk",{title:"Oh Oh je bent offline"})}catch(r){t(r)}});y.config();const C=h(import.meta.url),c=i.dirname(C),s=n(),d=process.env.PORT||3e3;process.env.NODE_ENV==="development"&&s.use(b("dev"));s.use(v());process.env.NODE_ENV==="production"&&(s.use(/.*-[0-9a-f]{10}\..*/,(o,e,t)=>{e.setHeader("Cache-Control","max-age=365000000, immutable"),t()}),s.use(I(i.join(c,"favicon.ico"))));s.use(g.json());s.use(g.urlencoded({extended:!0}));process.env.NODE_ENV==="production"&&(s.use("/",n.static("static")),s.use("/",n.static("public")),s.use("/assets",n.static("assets")),s.get("/sw.js",(o,e)=>{e.sendFile(i.resolve(c,"public/","sw.js"))}));process.env.NODE_ENV==="development"&&(s.use("/",n.static(i.join(c,"static"))),s.use("/assets",n.static(i.join(c,"../assets"))),s.use("/",n.static(i.join(c,"../../public"))));s.set("view engine","njk");s.set("views",i.join(c,"views"));k(s,{templateDirs:i.join(c,"views"),loader:j.FileSystemLoader});s.use(l);s.get("*",function(o,e,t){let r=new Error(`${o.ip} tried to reach ${o.originalUrl}`);r.statusCode=404,r.shouldRedirect=!0,t(r)});s.use((o,e,t,r)=>{console.error(o),t.render("error.njk",{title:error,error:o})});s.listen(d,()=>{console.log(c),console.log(`Server is listening on port ${d}...`)});
//# sourceMappingURL=server.js.map
