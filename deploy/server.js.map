{"version":3,"file":"server.js","sources":["../src/server/helpers/api.js","../src/server/controllers/HomeController.js","../src/server/controllers/CollectionController.js","../src/server/controllers/SearchController.js","../src/server/router/index.js","../src/server/server.js"],"sourcesContent":["import fetch from 'node-fetch';\n\n// const baseURL = `https://www.rijksmuseum.nl/api/en/collection?key=${process.env.VITE_API_KEY}&imgonly=true`;\n\nexport const searchAll = async (q) => {\n  const baseURL = `https://www.rijksmuseum.nl/api/en/collection?key=${process.env.VITE_API_KEY}&imgonly=true`;\n  let URL = baseURL;\n  try {\n    let search = `&q=${q}`;\n    // let search = ``;\n    // if (q) {\n      \n    // }\n    URL = baseURL + search;\n    console.log(URL);\n    const data = await request(URL);\n    const formattedResults = await formatMuseumResults(data);\n    return formattedResults;\n  } catch (error) {\n    console.log(error);\n  } finally {\n    console.log(\"SearchDone\");\n  }\n};\n\nexport const getMuseumDataByMaker = async (q) => {\n  try {\n    const baseURL = `https://www.rijksmuseum.nl/api/en/collection?key=${process.env.VITE_API_KEY}`;\n    const maker = `&involvedMaker=${q}`;\n    const options = '&imgonly=true&ps=5&toppieces=true'\n    const URL = baseURL + maker;\n    // console.log(URL)\n    const data = await request(URL);\n    const formattedResults = await formatMuseumResults(data);\n    return formattedResults;\n  } catch (err) {\n    console.log(err);\n  } finally {\n    console.log(\"got By maker\");\n  }\n};\n\nexport const searchId = async (id) => {\n  const baseURL = `https://www.rijksmuseum.nl/api/en/collection/${id}/?key=${process.env.VITE_API_KEY}`;\n  // const URL = baseURL + search;\n  try {\n    const data = await request(baseURL);\n    const formattedResult = await formatMuseumResult(data);\n    // console.log(formattedResult);\n    return formattedResult;\n  } catch (error) {\n    console.log(error);\n  } finally {\n    console.log(\"Got id \");\n  }\n};\n\nconst request = async (url) => {\n  try {\n    const res = await fetch(url);\n    const data = await res.json();\n    return data;\n  } catch (err) {\n    console.log(err);\n    throw new Error(err);\n  }\n};\n\nexport const formatMuseumResults = (data) => {\n  const array = data.artObjects;\n  return array.map((d) => {\n    return {\n      id: d.objectNumber,\n      title: d.title,\n      name: d.name,\n      headerImage: d.headerImage,\n      productionPlaces: d.productionPlaces,\n      links: d.links,\n      longTitle: d.longTitle,\n      webImage: d.webImage,\n      principalOrFirstMaker: d.principalOrFirstMaker,\n    };\n  });\n};\n\nexport const formatMuseumResult = (data) => {\n  const d = data.artObject\n  return {\n    id: d.objectNumber,\n    title: d.title,\n    titles: d.titles,\n    materials: d.materials,\n    description: d.description,\n    productionPlaces: d.productionPlaces,\n    longTitle: d.longTitle,\n    webImage: d.webImage,\n    principalOrFirstMaker: d.principalOrFirstMaker,\n    physicalMedium: d.physicalMedium,\n    subTitle: d.subTitle,\n    plaqueDescription: d.plaqueDescription,\n    principalMaker: d.principalMaker,\n    location: d.location,\n  };\n};\n","import { getMuseumDataByMaker, searchAll } from '../helpers/api.js'\n// import { searchAll, getMuseumDataByMaker } from '';\n\n\nconst apiKey = 'S3GLzVAr';\nconst URL = `https://www.rijksmuseum.nl/api/en/collection?key=${apiKey}&imgonly=true`;\n\n// const thisUser = req.user;\n// \tlet users = [];\n\t\n// \ttry {\n// \t\tartwork = await matchHelper.users(thisUser);\n// \t\tif (req.user) {\n// \t\t\tres.render('pages/index', {\n// \t\t\t\ttitle: 'Discover',\n// \t\t\t\tuser: req.user,\n// \t\t\t\tusers: users\n// \t\t\t});\n// \t\t} else {\n// \t\t\tres.redirect('/error');\n// \t\t}\n// \t} catch (err) {\n// \t\tnext(err);\n// \t}\nexport const HomeController = async (req,res, next) => {\n\t\n\ttry {\n\t\tconst rembrand = await getMuseumDataByMaker('Rembrandt+van+Rijn');\n\t\tconst Johannes = await getMuseumDataByMaker('Johannes+Vermeer');\n\n\t\treturn res.render('index.njk', {\n\t\t\ttitle: 'home',\n\t\t\tmakers: [{\n\t\t\t\tname: 'Rembrand',\n\t\t\t\tdata: rembrand\n\t\t\t},{\n\t\t\t\tname: 'Johannes Vermeer',\n\t\t\t\tdata: Johannes\n\t\t\t},\n\t\t]\n\t\t});\n\t} catch (err) {\n\t\tconsole.log(err)\n\t\tnext(err)\n\t}\n};\n\n\n\n\nexport default HomeController;","import { searchAll, searchId } from \"../helpers/api.js\";\n\nexport const CollectionController = async (req,res, next) => {\n\ttry {\n\t\tconst data = await searchAll('Rembrand');\n\t\treturn res.render('collection.njk', {\n\t\t\ttitle: 'Collecton',\n\t\t\tquery: 'Rembrand',\n\t\t\tdata: data\n\t\t})\n\t} catch (err) {\n\t\tconsole.log(err)\n\t\tnext(err)\n\t}\n}\n\nexport const CollectionDetailsController = async (req,res, next) => {\n  const id = req.params.id;\n\tconsole.log(req.params)\n\ttry {\n\t\tconst data = await searchId(id);\n\t\treturn res.render('details.njk', {\n\t\t\ttitle: 'Collecton',\n\t\t\tdata: data\n\t\t})\n\t} catch (err) {\n\t\tconsole.log(err)\n\t\tnext(err)\n\t}\n}\n\n\nexport default CollectionController\n","import { searchAll } from \"../helpers/api.js\";\nexport const SearchController = async (req,res, next) => {\n\tconst query = await req.query.q;\n\ttry {\n\t\tconsole.log(req.query)\n\t\tconst data = await searchAll(query);\n\t\t// console.log(data)\n\t\treturn res.render('search.njk', {\n\t\t\ttitle: 'Search',\n\t\t\tquery: query,\n\t\t\tdata: data\n\t\t})\n\t} catch (error) {\n\t\tnext(err)\n\t}\n}\nexport default SearchController","import express from \"express\";\nimport { HomeController } from '../controllers/HomeController.js';\nimport { CollectionController, CollectionDetailsController } from '../controllers/CollectionController.js';\nimport SearchController from \"../controllers/SearchController.js\";\n\nconst router = express.Router();\n\nrouter.get(\"/\", HomeController);\nrouter.get(\"/search/:q\", SearchController);\n\nrouter.get(\"/collection\", CollectionController);\nrouter.get(\"/collection/:id\", CollectionDetailsController);\n\n\nexport default router;\n","import express from 'express';\nimport ViteExpress from 'vite-express';\nimport bodyParser from 'body-parser';\nimport path from 'path';\nimport { fileURLToPath } from 'node:url';\nimport dotenv  from \"dotenv\";\nimport logger from 'morgan';\nimport nunjucks from 'nunjucks';\nimport expressNunjucks from 'express-nunjucks';\nimport compression from 'compression';\nimport favicon from 'serve-favicon';\nimport fetch from 'node-fetch';\n\nimport router from './router/index.js';\n\n\ndotenv.config();\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\nconst app = express();\n\nconst PORT = process.env.PORT || 3000;\n\n\n\nif (process.env.NODE_ENV === 'development') {\napp.use(logger('dev'));\n}\n\n\napp.use(compression())\n\nif (process.env.NODE_ENV === 'production') {\napp.use(/.*-[0-9a-f]{10}\\..*/, (req, res, next) => {\n  res.setHeader('Cache-Control', 'max-age=365000000, immutable');\n  next();\n});\napp.use(favicon(path.join(__dirname, 'favicon.ico')));\n}\n\n\n\n\n// const hbs = exphbs.create({\n//   defaultLayout: 'main',\n//   partialsDir: __dirname + '/views/partials/'\n// })\n\n\n// app.engine('handlebars', 'njk')\n\n\n\n// app.use(favicon(path.join(__dirname, 'favicon.ico')));\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({\n\textended: true\n}));\n\n\n\nif (process.env.NODE_ENV === 'production') {\n\tapp.use('/', express.static('static'));\n\tapp.use('/', express.static('public'));\n\tapp.use('/assets', express.static('assets'));  \n\n\tapp.get(\"/sw.js\", (req, res) => {\n\t\tres.sendFile(path.resolve(__dirname, \"public/\", \"sw.js\"));\n\t});\n\n}\n\nif (process.env.NODE_ENV === 'development') {\n\t// app.use(express.static('./public/', {\n\t// \tredirect:true\n\t// }))\n\tapp.use(\"/\", express.static(path.join(__dirname, \"static\")));\n\tapp.use(\"/assets\", express.static(path.join(__dirname, \"../assets\")));\n\tapp.use(\"/\", express.static(path.join(__dirname, \"../../public\")));\n\n\t// app.get(\"/sw.js\", (req, res) => {\n\t// \tres.sendFile(path.resolve(__dirname, \"public/\", \"sw.js\"));\n\t// });\n}\n\napp.set('view engine', 'njk');\napp.set('views', path.join(__dirname, 'views'));\n\n\nconst njk = expressNunjucks(app, {\n  templateDirs: path.join(__dirname, 'views'),\n  loader: nunjucks.FileSystemLoader,\n});\n\n// app.get(\"/sw.js\", (req, res) => {\n//   res.sendFile(path.resolve(__dirname, \"public/\", \"sw.js\"));\n// });\n\napp.use(router);\n\n\n\n// app.get(\"/\", HomeController);\n// app.get(\"/search/:q\", SearchController);\n\n// app.get(\"/collection\", CollectionController);\n// app.get(\"/collection/:id\", CollectionDetailsController);\n\napp.get('/offline', (req, res, next) => {\n  res.render('offline.njk', {\n\t\ttitle: 'Oh Oh je bent offline'\n\t});\n  next()\n})\n\napp.get('*', function (req, res, next) {\n\tlet err = new Error(`${req.ip} tried to reach ${req.originalUrl}`); // Tells us which IP tried to reach a particular URL\n\terr.statusCode = 404;\n\terr.shouldRedirect = true; //New property on err so that our middleware will redirect\n\tnext(err);\n});\n\napp.use((err, req, res, next) => {\n\tconsole.error(err);\n\tres.render('error.njk', {\n\t\ttitle: error,\n\t\terror: err\n\t});\n});\n\n\nViteExpress.listen(app, PORT, () => {\n  console.log(__dirname)\n  console.log(`Server is listening on port ${PORT}...`)\n});\n\n\n\n// app.listen(PORT, () => {\n//   console.log(__dirname);\n//   console.log(`Server is listening on port ${PORT}...`);\n// });\n"],"names":["error","err"],"mappings":"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"}