{"version":3,"file":"server.js","sources":["../src/server/helpers/api.js","../src/server/controllers/HomeController.js","../src/server/controllers/CollectionController.js","../src/server/controllers/SearchController.js","../src/server/router/index.js","../src/server/server.js"],"sourcesContent":["import fetch from 'node-fetch';\n\n// const baseURL = `https://www.rijksmuseum.nl/api/en/collection?key=${process.env.VITE_API_KEY}&imgonly=true`;\n\nexport const searchAll = async (q) => {\n  const baseURL = `https://www.rijksmuseum.nl/api/en/collection?key=${process.env.VITE_API_KEY}&imgonly=true`;\n  let URL = baseURL;\n  try {\n    let search = `&q=${q}`;\n    // let search = ``;\n    // if (q) {\n      \n    // }\n    URL = baseURL + search;\n    console.log(URL);\n    const data = await request(URL);\n    const formattedResults = await formatMuseumResults(data);\n    return formattedResults;\n  } catch (error) {\n    console.log(error);\n  } finally {\n    console.log(\"SearchDone\");\n  }\n};\n\nexport const getMuseumDataByMaker = async (q) => {\n  try {\n    const baseURL = `https://www.rijksmuseum.nl/api/en/collection?key=${process.env.VITE_API_KEY}`;\n    const maker = `&involvedMaker=${q}`;\n    const options = '&imgonly=true&ps=5&toppieces=true'\n    const URL = baseURL + maker;\n    // console.log(URL)\n    const data = await request(URL);\n    const formattedResults = await formatMuseumResults(data);\n    return formattedResults;\n  } catch (err) {\n    console.log(err);\n  } finally {\n    console.log(\"got By maker\");\n  }\n};\n\nexport const searchId = async (id) => {\n  const baseURL = `https://www.rijksmuseum.nl/api/en/collection/${id}/?key=${process.env.VITE_API_KEY}`;\n  // const URL = baseURL + search;\n  try {\n    const data = await request(baseURL);\n    const formattedResult = await formatMuseumResult(data);\n    // console.log(formattedResult);\n    return formattedResult;\n  } catch (error) {\n    console.log(error);\n  } finally {\n    console.log(\"Got id \");\n  }\n};\n\nconst request = async (url) => {\n  try {\n    const res = await fetch(url);\n    const data = await res.json();\n    return data;\n  } catch (err) {\n    console.log(err);\n    throw new Error(err);\n  }\n};\n\nexport const formatMuseumResults = (data) => {\n  const array = data.artObjects;\n  return array.map((d) => {\n    const smallImageUrl = d.webImage && d.webImage.url.endsWith('=s0') ? d.webImage.url.replace('=s0', '=s800') : undefined;\n\n    return {\n      id: d.objectNumber,\n      title: d.title,\n      name: d.name,\n      headerImage: d.headerImage,\n      productionPlaces: d.productionPlaces,\n      links: d.links,\n      longTitle: d.longTitle,\n      webImage: d.webImage,\n      smallImage: smallImageUrl,\n      principalOrFirstMaker: d.principalOrFirstMaker,\n    };\n  });\n};\n\nexport const formatMuseumResult = (data) => {\n  const d = data.artObject;\n  const smallImageUrl = d.webImage && d.webImage.url.endsWith('=s0') ? d.webImage.url.replace('=s0', '=s800') : undefined;\n  return {\n    id: d.objectNumber,\n    title: d.title,\n    titles: d.titles,\n    materials: d.materials,\n    description: d.description,\n    productionPlaces: d.productionPlaces,\n    longTitle: d.longTitle,\n    webImage: d.webImage,\n    smallImage: smallImageUrl, \n    principalOrFirstMaker: d.principalOrFirstMaker,\n    physicalMedium: d.physicalMedium,\n    subTitle: d.subTitle,\n    plaqueDescription: d.plaqueDescription,\n    principalMaker: d.principalMaker,\n    location: d.location,\n  };\n};\n","import { getMuseumDataByMaker, searchAll } from '../helpers/api.js'\n// import { searchAll, getMuseumDataByMaker } from '';\n\n\nconst apiKey = 'S3GLzVAr';\nconst URL = `https://www.rijksmuseum.nl/api/en/collection?key=${apiKey}&imgonly=true`;\n\n// const thisUser = req.user;\n// \tlet users = [];\n\t\n// \ttry {\n// \t\tartwork = await matchHelper.users(thisUser);\n// \t\tif (req.user) {\n// \t\t\tres.render('pages/index', {\n// \t\t\t\ttitle: 'Discover',\n// \t\t\t\tuser: req.user,\n// \t\t\t\tusers: users\n// \t\t\t});\n// \t\t} else {\n// \t\t\tres.redirect('/error');\n// \t\t}\n// \t} catch (err) {\n// \t\tnext(err);\n// \t}\nexport const HomeController = async (req,res, next) => {\n\t\n\ttry {\n\t\tconst rembrand = await getMuseumDataByMaker('Rembrandt+van+Rijn');\n\t\tconst Johannes = await getMuseumDataByMaker('Johannes+Vermeer');\n\n\t\treturn res.render('index.njk', {\n\t\t\ttitle: 'home',\n\t\t\tmakers: [{\n\t\t\t\tname: 'Rembrand',\n\t\t\t\tdata: rembrand\n\t\t\t},{\n\t\t\t\tname: 'Johannes Vermeer',\n\t\t\t\tdata: Johannes\n\t\t\t},\n\t\t]\n\t\t});\n\t} catch (err) {\n\t\tconsole.log(err)\n\t\tnext(err)\n\t}\n};\n\n\n\n\nexport default HomeController;","import { searchAll, searchId } from \"../helpers/api.js\";\n\nexport const CollectionController = async (req,res, next) => {\n\ttry {\n\t\tconst data = await searchAll('Rembrand');\n\t\treturn res.render('collection.njk', {\n\t\t\ttitle: 'Collecton',\n\t\t\tquery: 'Rembrand',\n\t\t\tdata: data\n\t\t})\n\t} catch (err) {\n\t\tconsole.log(err)\n\t\tnext(err)\n\t}\n}\n\nexport const CollectionDetailsController = async (req,res, next) => {\n  const id = req.params.id;\n\tconsole.log(req.params)\n\ttry {\n\t\tconst data = await searchId(id);\n\t\treturn res.render('details.njk', {\n\t\t\ttitle: 'Collecton',\n\t\t\tdata: data\n\t\t})\n\t} catch (err) {\n\t\tconsole.log(err)\n\t\tnext(err)\n\t}\n}\n\n\nexport default CollectionController\n","import { searchAll } from \"../helpers/api.js\";\nexport const SearchController = async (req,res, next) => {\n\tconst query = await req.query.q;\n\ttry {\n\t\tconsole.log(req.query)\n\t\tconst data = await searchAll(query);\n\t\t// console.log(data)\n\t\treturn res.render('search.njk', {\n\t\t\ttitle: 'Search',\n\t\t\tquery: query,\n\t\t\tdata: data\n\t\t})\n\t} catch (error) {\n\t\tnext(err)\n\t}\n}\nexport default SearchController","import express from \"express\";\nimport { HomeController } from '../controllers/HomeController.js';\nimport { CollectionController, CollectionDetailsController } from '../controllers/CollectionController.js';\nimport SearchController from \"../controllers/SearchController.js\";\n\nconst router = express.Router();\n\nrouter.get(\"/\", HomeController);\nrouter.get(\"/search/:q\", SearchController);\n\nrouter.get(\"/collection\", CollectionController);\nrouter.get(\"/collection/:id\", CollectionDetailsController);\nrouter.get('/offline', (req, res, next) => {\n  try {\n    res.render('offline.njk', {\n      title: 'Oh Oh je bent offline'\n    });\n  } catch (err) {\n    next(err)\n  }\n})\n\nexport default router;\n","import express from 'express';\nimport ViteExpress from 'vite-express';\nimport bodyParser from 'body-parser';\nimport path from 'path';\nimport { fileURLToPath } from 'node:url';\nimport dotenv  from \"dotenv\";\nimport logger from 'morgan';\nimport nunjucks from 'nunjucks';\nimport expressNunjucks from 'express-nunjucks';\nimport compression from 'compression';\nimport favicon from 'serve-favicon';\nimport fetch from 'node-fetch';\n\nimport router from './router/index.js';\n\n\ndotenv.config();\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\nconst app = express();\n\nconst PORT = process.env.PORT || 3000;\n\n\n\nif (process.env.NODE_ENV === 'development') {\napp.use(logger('dev'));\n}\n\n\napp.use(compression())\n\nif (process.env.NODE_ENV === 'production') {\napp.use(/.*-[0-9a-f]{10}\\..*/, (req, res, next) => {\n  res.setHeader('Cache-Control', 'max-age=365000000, immutable');\n  next();\n});\napp.use(favicon(path.join(__dirname, 'favicon.ico')));\n}\n\n\n\n\n// const hbs = exphbs.create({\n//   defaultLayout: 'main',\n//   partialsDir: __dirname + '/views/partials/'\n// })\n\n\n// app.engine('handlebars', 'njk')\n\n\n\n// app.use(favicon(path.join(__dirname, 'favicon.ico')));\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({\n\textended: true\n}));\n\n\n\nif (process.env.NODE_ENV === 'production') {\n\tapp.use('/', express.static('static'));\n\tapp.use('/', express.static('public'));\n\tapp.use('/assets', express.static('assets'));  \n\n\tapp.get(\"/sw.js\", (req, res) => {\n\t\tres.sendFile(path.resolve(__dirname, \"public/\", \"sw.js\"));\n\t});\n\n}\n\nif (process.env.NODE_ENV === 'development') {\n\t// app.use(express.static('./public/', {\n\t// \tredirect:true\n\t// }))\n\tapp.use(\"/\", express.static(path.join(__dirname, \"static\")));\n\tapp.use(\"/assets\", express.static(path.join(__dirname, \"../assets\")));\n\tapp.use(\"/\", express.static(path.join(__dirname, \"../../public\")));\n\n\t// app.get(\"/sw.js\", (req, res) => {\n\t// \tres.sendFile(path.resolve(__dirname, \"public/\", \"sw.js\"));\n\t// });\n}\n\napp.set('view engine', 'njk');\napp.set('views', path.join(__dirname, 'views'));\n\n\nconst njk = expressNunjucks(app, {\n  templateDirs: path.join(__dirname, 'views'),\n  loader: nunjucks.FileSystemLoader,\n});\n\n// app.get(\"/sw.js\", (req, res) => {\n//   res.sendFile(path.resolve(__dirname, \"public/\", \"sw.js\"));\n// });\n\napp.use(router);\n\n\n\n// app.get(\"/\", HomeController);\n// app.get(\"/search/:q\", SearchController);\n\n// app.get(\"/collection\", CollectionController);\n// app.get(\"/collection/:id\", CollectionDetailsController);\n\n// app.get('/offline', (req, res, next) => {\n//   res.render('offline.njk', {\n// \t\ttitle: 'Oh Oh je bent offline'\n// \t});\n//   next()\n// })\n\napp.get('*', function (req, res, next) {\n\tlet err = new Error(`${req.ip} tried to reach ${req.originalUrl}`); // Tells us which IP tried to reach a particular URL\n\terr.statusCode = 404;\n\terr.shouldRedirect = true; //New property on err so that our middleware will redirect\n\tnext(err);\n});\n\napp.use((err, req, res, next) => {\n\tconsole.error(err);\n\tres.render('error.njk', {\n\t\ttitle: error,\n\t\terror: err\n\t});\n});\n\n\n// ViteExpress.listen(app, PORT, () => {\n//   console.log(__dirname)\n//   console.log(`Server is listening on port ${PORT}...`)\n// });\n\n\n\napp.listen(PORT, () => {\n  console.log(__dirname);\n  console.log(`Server is listening on port ${PORT}...`);\n});\n"],"names":["searchAll","q","baseURL","URL","search","data","request","formatMuseumResults","error","getMuseumDataByMaker","maker","options","err","searchId","id","formatMuseumResult","url","fetch","d","smallImageUrl","HomeController","req","res","next","rembrand","Johannes","CollectionController","CollectionDetailsController","SearchController","query","router","express","dotenv","__filename","fileURLToPath","__dirname","path","app","PORT","logger","compression","favicon","bodyParser","expressNunjucks","nunjucks"],"mappings":"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"}